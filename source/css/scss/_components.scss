// ==========================================================================
// Components - 재사용 가능한 UI 컴포넌트
// ==========================================================================

// 버튼
// --------------------------------------------------------------------------
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: spacer(2);
  padding: spacer(3) spacer(6);
  font-size: font-size(base);
  font-weight: font-weight(medium);
  line-height: 1;
  text-align: center;
  text-decoration: none;
  border: 1px solid transparent;
  border-radius: radius(base);
  cursor: pointer;
  transition: var(--motion-transition-interactive, var(--motion-transition-base, #{$transition-base}));
  user-select: none;

  &:focus-visible {
    @include focus-outline(var(--interactive-focus-ring, var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})))));
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

// 버튼 크기
.btn-sm {
  padding: spacer(2) spacer(4);
  font-size: font-size(sm);
}

.btn-lg {
  padding: spacer(4) spacer(8);
  font-size: font-size(lg);
}

// 버튼 스타일
.btn-primary {
  color: var(--color-white, #{color(white)});
  background-color: var(--color-primary, #{color(primary)});
  border-color: var(--color-primary, #{color(primary)});

  &:hover:not(:disabled) {
    color: var(--color-white, #{color(white)});
    background-color: var(--color-primary-dark, #{color(primary-dark)});
    border-color: var(--color-primary-dark, #{color(primary-dark)});
  }
}

.btn-secondary {
  color: var(--color-white, #{color(white)});
  background-color: var(--color-secondary, #{color(secondary)});
  border-color: var(--color-secondary, #{color(secondary)});

  &:hover:not(:disabled) {
    color: var(--color-white, #{color(white)});
    background-color: #{color(secondary-dark)};
    border-color: #{color(secondary-dark)};
  }
}

.btn-outline {
  color: var(--color-primary, #{color(primary)});
  background-color: transparent;
  border-color: var(--color-primary, #{color(primary)});

  &:hover:not(:disabled) {
    color: var(--color-white, #{color(white)});
    background-color: var(--color-primary, #{color(primary)});
  }
}

// 카드
// --------------------------------------------------------------------------
.card {
  display: flex;
  flex-direction: column;
  background-color: var(--color-bg, #{color(bg-primary)});
  border: 1px solid var(--color-border, #{color(border)});
  border-radius: radius(md);
  box-shadow: shadow(sm);
  overflow: hidden;

  // 카드 내부 공통 인터랙션 포커스 스타일
  :is(a, button, [role="button"], [tabindex]:not([tabindex="-1"])):focus-visible {
    @include focus-outline(var(--interactive-focus-ring, var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})))));
  }
}

.card-header {
  padding: spacer(6);
  border-bottom: 1px solid var(--color-border);
  font-weight: font-weight(semibold);
}

.card-body {
  flex: 1;
  padding: spacer(6);
}

.card-footer {
  padding: spacer(6);
  border-top: 1px solid var(--color-border, #{color(border)});
  background-color: var(--color-bg-alt, #{color(bg-secondary)});
}

// 입력 필드
// --------------------------------------------------------------------------
// 폼 컨트롤 포커스 토큰 (커스터마이징: 변수를 오버라이드하세요)
:root {
  --focus-ring-color: var(--color-primary-dark, #{color(primary-dark)});
  --focus-ring-width: 3px;
  --focus-ring-offset: 2px;
}

.form-group {
  margin-bottom: spacer(6);
}

.form-label {
  display: block;
  margin-bottom: spacer(2);
  font-weight: font-weight(medium);
  color: var(--color-text);
}

.form-control {
  display: block;
  width: 100%;
  padding: spacer(3) spacer(4);
  font-size: font-size(base);
  line-height: line-height(normal);
  color: var(--text-primary, var(--color-text, #{color(text-primary)}));
  background-color: var(--surface, var(--color-bg, #{color(bg-primary)}));

  // NOTE(a11y): input/textarea/select 같은 UI 컴포넌트 경계선은
  // WCAG 2.1 1.4.11(비텍스트 대비) 기준(인접 대비 3:1+)을 만족하는 색을 우선 사용.
  border: 1px solid var(--border, var(--color-border, #{color(border)}));
  border-radius: radius(base);
  transition: var(--motion-transition-interactive, var(--motion-transition-fast, #{$transition-fast}));

  // 포커스 링은 전역 토큰/믹스인으로 통일(:focus-visible 우선)
  &:focus-visible {
    @include focus-outline(var(--form-focus-ring-color, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))), var(--form-focus-ring-offset, var(--focus-ring-offset, 2px)));
    border-color: var(--form-focus-ring-color, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  }

  // 폼 컨트롤은 focus-visible 미지원 환경에서도 최소한의 구분은 필요
  &:focus {
    border-color: var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}));
  }

  &::placeholder {
    color: var(--color-text);
    opacity: 0.5;
  }

  &:disabled {
    background-color: var(--color-bg-alt);
    cursor: not-allowed;
  }
}

textarea.form-control {
  min-height: 100px;
  resize: vertical;
}

// 체크박스 & 라디오
// --------------------------------------------------------------------------
.form-check {
  display: flex;
  align-items: center;
  gap: spacer(2);
  margin-bottom: spacer(3);
}

.form-check-input {
  width: 1.6rem;
  height: 1.6rem;
  cursor: pointer;

  &:focus-visible {
    @include focus-outline(var(--form-focus-ring-color, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))), var(--form-focus-ring-offset, var(--focus-ring-offset, 2px)));
  }
}

.form-check-label {
  cursor: pointer;
}

// 뱃지
// --------------------------------------------------------------------------
.badge {
  display: inline-flex;
  align-items: center;
  padding: spacer(1) spacer(3);
  font-size: font-size(xs);
  font-weight: font-weight(semibold);
  line-height: 1;
  border-radius: radius(full);
}

.badge-primary {
  color: var(--color-white);
  background-color: var(--color-primary);
}

.badge-success {
  color: var(--color-white);
  background-color: var(--color-accent);
}

.badge-warning {
  color: color(gray-900);
  background-color: color(warning);
}

// 알림 (Alert)
// --------------------------------------------------------------------------
.alert {
  padding: spacer(6);
  margin-bottom: spacer(6);
  border: 1px solid transparent;
  border-radius: radius(base);
}

.alert-info {
  color: darken(color(info), 20%);
  background-color: lighten(color(info), 40%);
  border-color: lighten(color(info), 30%);
}

.alert-success {
  color: darken(color(success), 20%);
  background-color: lighten(color(success), 60%);
  border-color: lighten(color(success), 50%);
}

.alert-warning {
  color: darken(color(warning), 40%);
  background-color: lighten(color(warning), 30%);
  border-color: lighten(color(warning), 20%);
}

// 모달 (기본 구조)
// --------------------------------------------------------------------------
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: z(modal);
  overflow: auto;

  &.is-active {
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: z(modal-backdrop);
  transition: var(--motion-transition-interactive, var(--motion-transition-base, #{$transition-base}));
}

.modal-content {
  position: relative;
  background-color: var(--color-bg);
  border-radius: radius(lg);
  max-width: 500px;
  width: 90%;
  z-index: z(modal);
  box-shadow: shadow(2xl);
  transition: var(--motion-transition-interactive, var(--motion-transition-base, #{$transition-base}));

  &:focus-visible {
    @include focus-outline(var(--interactive-focus-ring, var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})))));
  }

  // 모달 내부 인터랙션 요소도 공통 토큰 사용
  :is(a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])):focus-visible {
    @include focus-outline(var(--interactive-focus-ring, var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})))));
  }
}

.modal-header,
.modal-body,
.modal-footer {
  padding: spacer(6);
}

.modal-header {
  border-bottom: 1px solid var(--color-border);

  // 접근성: 모달 오픈 시 제목(heading)에 프로그램 포커스를 줄 수 있도록
  // tabindex="-1" 제목에 포커스 스타일을 제공한다.
  // (:focus-visible만으로는 프로그램 포커스가 표시되지 않을 수 있음)
  > :is(h1, h2, h3, h4, h5, h6)[tabindex="-1"]:focus {
    @include focus-outline(var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  }
}

.modal-footer {
  border-top: 1px solid var(--color-border);
  display: flex;
  gap: spacer(3);
  justify-content: flex-end;
}

// 공통 focus-visible 스타일
// --------------------------------------------------------------------------
:where(
  button, input, select, textarea, a,
  .btn, .form-control, .form-check-input,
  [role="button"], summary,
  [tabindex]:not([tabindex="-1"])
):not([disabled]):not([aria-disabled="true"]):focus-visible {
  outline: var(--focus-ring-width) solid var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
}

// 마우스 클릭 시 포커스 링 숨김
:where(
  button, input, select, textarea, a,
  .btn, .form-control, .form-check-input,
  [role="button"], summary,
  [tabindex]:not([tabindex="-1"])
):not([disabled]):not([aria-disabled="true"]):focus:not(:focus-visible) {
  outline: none;
}

// 고대비(Forced Colors) 모드
@media (forced-colors: active) {
  :focus-visible {
    outline: 2px solid Highlight;
    outline-offset: 2px;
  }
}

// 모션 감소 선호 시
@media (prefers-reduced-motion: reduce) {
  html:focus-within {
    scroll-behavior: auto;
  }

  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
