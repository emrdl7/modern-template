// ==========================================================================
// Components - 재사용 가능한 UI 컴포넌트
// ==========================================================================

// 버튼
// --------------------------------------------------------------------------
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: spacer(2);
  padding: spacer(3) spacer(6);
  font-size: font-size(base);
  font-weight: font-weight(medium);
  line-height: 1;
  text-align: center;
  text-decoration: none;
  border: 1px solid transparent;
  border-radius: radius(base);
  cursor: pointer;
  transition: var(--motion-transition-interactive, var(--motion-transition-base, #{$transition-base}));
  user-select: none;

  &:focus-visible {
    // 버튼 포커스 링 대비 강화(공통 strong 토큰 우선)
    @include focus-outline(var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))));
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

// 버튼 크기
.btn-sm {
  padding: spacer(2) spacer(4);
  font-size: font-size(sm);
}

.btn-lg {
  padding: spacer(4) spacer(8);
  font-size: font-size(lg);
}

// 버튼 스타일
.btn-primary {
  color: var(--color-white, #{color(white)});
  background-color: var(--color-primary, #{color(primary)});
  border-color: var(--color-primary, #{color(primary)});

  &:hover:not(:disabled) {
    background-color: var(--color-primary-dark, #{color(primary-dark)});
    border-color: var(--color-primary-dark, #{color(primary-dark)});
  }

  &:focus-visible {
    // primary 배경 위에서도 링 경계가 분리되도록 strong 토큰 우선 사용
    @include focus-outline(var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))));
  }
}

.btn-secondary {
  color: var(--color-white, #{color(white)});
  background-color: var(--color-secondary, #{color(secondary)});
  border-color: var(--color-secondary, #{color(secondary)});

  &:hover:not(:disabled) {
    background-color: #{color(secondary-dark)};
    border-color: #{color(secondary-dark)};
  }

  &:focus-visible {
    // secondary 계열 배경에서도 경계가 분명하게 보이도록 strong 토큰 우선 사용
    @include focus-outline(var(--focus-ring-strong, var(--focus-ring, var(--color-secondary-dark, #{color(secondary-dark)}))));
  }
}

.btn-outline {
  color: var(--color-primary, #{color(primary)});
  background-color: transparent;
  border-color: var(--color-primary, #{color(primary)});

  &:hover:not(:disabled) {
    color: var(--color-white, #{color(white)});
    background-color: var(--color-primary, #{color(primary)});
  }

  &:focus-visible {
    // outline 버튼은 배경 대비 변동이 커서 strong 토큰으로 가시성 확보
    @include focus-outline(var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))));
  }
}

// 카드
// --------------------------------------------------------------------------
.card {
  display: flex;
  flex-direction: column;
  background-color: var(--color-bg, #{color(bg-primary)});
  border: 1px solid var(--color-border, #{color(border)});
  border-radius: radius(md);
  box-shadow: shadow(sm);
  overflow: hidden;

  // 카드 내부 공통 인터랙션 포커스 스타일
  :is(a, button, [role="button"], [tabindex]:not([tabindex="-1"])):focus-visible {
    @include focus-outline(var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))));
  }
}

.card-header {
  padding: spacer(6);
  border-bottom: 1px solid color(border);
  font-weight: font-weight(semibold);
}

.card-body {
  flex: 1;
  padding: spacer(6);
}

.card-footer {
  padding: spacer(6);
  border-top: 1px solid var(--color-border, #{color(border)});
  background-color: var(--color-bg-alt, #{color(bg-secondary)});
}

// 입력 필드
// --------------------------------------------------------------------------
// 폼 컨트롤 포커스 토큰(커스터마이징 여지 확보)
:root {
  --form-focus-ring-color: var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  --form-focus-ring-width: var(--focus-ring-width-strong, max(2px, 0.15em));
  --form-focus-ring-offset: var(--focus-ring-offset-strong, var(--focus-ring-offset, 2px));
  --form-focus-ring-style: var(--focus-ring-style-strong, var(--focus-ring-style, solid));
  --focus-ring-surface-color: var(--focus-ring-surface, var(--color-bg, #{color(bg-primary)}));
  --focus-ring-gap-size: var(--focus-ring-gap, 2px);
  // 커스터마이징: 이중 링(내곽/외곽) 색을 분리 가능하도록 토큰 제공
  --focus-ring-inner-color: var(--focus-ring-surface-color, var(--color-bg, #{color(bg-primary)}));
  --focus-ring-outer-color: var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  --motion-transition-interactive: var(--motion-transition-base, #{$transition-base});
  // reduce 환경에서 완전 제거 대신 "짧은 페이드"로 커스터마이징 가능
  --motion-reduced-duration: 80ms;
}

.form-group {
  margin-bottom: spacer(6);
}

.form-label {
  display: block;
  margin-bottom: spacer(2);
  font-weight: font-weight(medium);
  color: color(text-primary);
}

.form-control {
  display: block;
  width: 100%;
  padding: spacer(3) spacer(4);
  font-size: font-size(base);
  line-height: line-height(normal);
  color: var(--text-primary, var(--color-text, #{color(text-primary)}));
  background-color: var(--surface, var(--color-bg, #{color(bg-primary)}));

  // NOTE(a11y): input/textarea/select 같은 UI 컴포넌트 경계선은
  // WCAG 2.1 1.4.11(비텍스트 대비) 기준(인접 대비 3:1+)을 만족하는 색을 우선 사용.
  border: 1px solid var(--border, var(--color-border, #{color(border)}));
  border-radius: radius(base);
  transition: var(--motion-transition-fast, #{$transition-fast});

  // 포커스 링은 전역 토큰/믹스인으로 통일(:focus-visible 우선)
  &:focus-visible {
    @include focus-outline(var(--form-focus-ring-color, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))), var(--form-focus-ring-offset, var(--focus-ring-offset, 2px)));
    border-color: var(--form-focus-ring-color, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  }

  // 폼 컨트롤은 focus-visible 미지원 환경에서도 최소한의 구분은 필요
  &:focus {
    border-color: var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}));
  }

  &::placeholder {
    color: #{color(gray-600)};
  }

  &:disabled {
    background-color: #{color(gray-100)};
    cursor: not-allowed;
  }
}

textarea.form-control {
  min-height: 100px;
  resize: vertical;
}

// 체크박스 & 라디오
// --------------------------------------------------------------------------
.form-check {
  display: flex;
  align-items: center;
  gap: spacer(2);
  margin-bottom: spacer(3);
}

.form-check-input {
  width: 1.6rem;
  height: 1.6rem;
  cursor: pointer;

  &:focus-visible {
    @include focus-outline(var(--form-focus-ring-color, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))), var(--form-focus-ring-offset, var(--focus-ring-offset, 2px)));
  }
}

.form-check-label {
  cursor: pointer;
}

// 뱃지
// --------------------------------------------------------------------------
.badge {
  display: inline-flex;
  align-items: center;
  padding: spacer(1) spacer(3);
  font-size: font-size(xs);
  font-weight: font-weight(semibold);
  line-height: 1;
  border-radius: radius(full);
}

.badge-primary {
  color: color(white);
  background-color: color(primary);
}

.badge-success {
  color: color(white);
  background-color: color(success);
}

.badge-warning {
  color: color(gray-900);
  background-color: color(warning);
}

// 알림 (Alert)
// --------------------------------------------------------------------------
.alert {
  padding: spacer(6);
  margin-bottom: spacer(6);
  border: 1px solid transparent;
  border-radius: radius(base);
}

.alert-info {
  color: darken(color(info), 20%);
  background-color: lighten(color(info), 40%);
  border-color: lighten(color(info), 30%);
}

.alert-success {
  color: darken(color(success), 20%);
  background-color: lighten(color(success), 60%);
  border-color: lighten(color(success), 50%);
}

.alert-warning {
  color: darken(color(warning), 40%);
  background-color: lighten(color(warning), 30%);
  border-color: lighten(color(warning), 20%);
}

// 모달 (기본 구조)
// --------------------------------------------------------------------------
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: z(modal);
  overflow: auto;

  &.is-active {
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: z(modal-backdrop);
  transition: var(--motion-transition-interactive, var(--motion-transition-base, #{$transition-base}));
}

.modal-content {
  position: relative;
  background-color: color(white);
  border-radius: radius(lg);
  max-width: 500px;
  width: 90%;
  z-index: z(modal);
  box-shadow: shadow(2xl);
  transition: var(--motion-transition-interactive, var(--motion-transition-base, #{$transition-base}));

  &:focus-visible {
    @include focus-outline(var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))));
  }

  // 모달 내부 인터랙션 요소의 focus-visible 대비를 한 단계 더 진하게 통일
  :is(a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])):focus-visible {
    @include focus-outline(var(--focus-ring-strong, var(--color-primary-dark, #{color(primary-dark)})));
  }
}

.modal-header,
.modal-body,
.modal-footer {
  padding: spacer(6);
}

.modal-header {
  border-bottom: 1px solid color(border);

  // 접근성: 모달 오픈 시 제목(heading)에 프로그램 포커스를 줄 수 있도록
  // tabindex="-1" 제목에 포커스 스타일을 제공한다.
  // (:focus-visible만으로는 프로그램 포커스가 표시되지 않을 수 있음)
  > :is(h1, h2, h3, h4, h5, h6)[tabindex="-1"]:focus {
    @include focus-outline(var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  }
}

.modal-footer {
  border-top: 1px solid color(border);
  display: flex;
  gap: spacer(3);
  justify-content: flex-end;
}

// 공통 focus-visible 토큰: 주요 인터랙션 컴포넌트 링 대비/두께를 한 번 더 고정
// --------------------------------------------------------------------------
:where(
  .btn,
  .form-control,
  .form-check-input,
  .modal-content,
  a,
  [role="button"],
  [tabindex]:not([tabindex="-1"])
):focus-visible {
  // outline shorthand로 색/두께/스타일을 한 번에 고정 (브라우저 기본 reset 영향 최소화)
  outline:
    var(--form-focus-ring-width, var(--focus-ring-width-strong, max(2px, 0.15em)))
    var(--form-focus-ring-style, var(--focus-ring-style-strong, var(--focus-ring-style, solid)))
    var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)})));
  // 커스터마이징 여지를 위해 offset은 토큰으로 분리
  outline-offset: var(--focus-ring-offset-strong, var(--focus-ring-offset, 2px));
  // 밝거나 복잡한 배경에서도 링 식별이 쉬운 2중 대비 링(옵션 토큰)
  box-shadow:
    0 0 0 var(--focus-ring-gap-size, var(--focus-ring-gap, 2px))
      var(--focus-ring-inner-color, var(--focus-ring-surface-color, var(--focus-ring-surface, var(--color-bg, #{color(bg-primary)})))),
    0 0 0 calc(var(--focus-ring-gap-size, var(--focus-ring-gap, 2px)) + var(--focus-ring-width-strong, max(2px, 0.15em)))
      var(--focus-ring-outer-color, var(--focus-ring-strong, var(--focus-ring, var(--color-primary-dark, #{color(primary-dark)}))));
}

:where(
  .btn,
  .form-control,
  .form-check-input,
  .modal-content,
  a,
  [role="button"],
  [tabindex]:not([tabindex="-1"])
):focus:not(:focus-visible) {
  // 마우스 클릭 시 과도한 포커스 링 노출을 줄여 키보드 포커스 가시성과 분리
  outline: none;
  box-shadow: none;
}

// 모션 감소 선호 시 컴포넌트 전환 비활성화
// --------------------------------------------------------------------------
@media (prefers-reduced-motion: reduce) {
  :root {
    // 모션 감소 환경: 이동 애니메이션은 제거하되, 상태 전환은 매우 짧게 유지(커스터마이징 가능)
    --motion-transition-base: opacity var(--motion-reduced-duration, 80ms) linear;
    --motion-transition-fast: opacity var(--motion-reduced-duration, 80ms) linear;
    --motion-transition-interactive: opacity var(--motion-reduced-duration, 80ms) linear;
  }

  html:focus-within {
    scroll-behavior: auto;
  }

  // 버튼/폼/기본 인터랙션: 이동 모션은 제거, 상태 전환은 짧은 페이드만 허용
  .btn,
  .btn::before,
  .btn::after,
  .form-control,
  .form-check-input,
  .card a,
  .card button,
  a,
  button {
    animation: none !important;
    transition-property: opacity, background-color, border-color, color !important;
    transition-duration: var(--motion-reduced-duration, 80ms) !important;
    transition-timing-function: linear !important;
    transform: none !important;
  }

  // 모달 계열: 이동 모션 제거 + 짧은 opacity 전환만 유지
  .modal,
  .modal-backdrop,
  .modal-content,
  .modal-content * {
    animation: none !important;
    transition-property: opacity !important;
    transition-duration: var(--motion-reduced-duration, 80ms) !important;
    transition-timing-function: linear !important;
    transform: none !important;
  }

  // 토스트/알림 계열도 즉시 상태 반영
  .toast,
  [data-toast],
  .alert {
    animation: none !important;
    transition: none !important;
    transform: none !important;
  }
}
